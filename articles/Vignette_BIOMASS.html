<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Estimating stand biomass • BIOMASS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimating stand biomass">
<meta name="description" content="Estimating above ground biomass with BIOMASS
">
<meta property="og:description" content="Estimating above ground biomass with BIOMASS
">
<meta property="og:image" content="https://umr-amap.github.io/BIOMASS/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BIOMASS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Vignette_BIOMASS.html">Estimating stand biomass</a></li>
    <li><a class="dropdown-item" href="../articles/Vignette_spatialized_trees_and_forest_stand_metrics.html">Spatialize trees and forest stand metrics with BIOMASS</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/umr-amap/BIOMASS/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimating stand biomass</h1>
                        <h4 data-toc-skip class="author">Arthur
Bailly</h4>
            
            <h4 data-toc-skip class="date">2025-10-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/umr-amap/BIOMASS/blob/master/vignettes/Vignette_BIOMASS.Rmd" class="external-link"><code>vignettes/Vignette_BIOMASS.Rmd</code></a></small>
      <div class="d-none name"><code>Vignette_BIOMASS.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="general-workflow-and-required-data">General workflow and required data<a class="anchor" aria-label="anchor" href="#general-workflow-and-required-data"></a>
</h2>
<p>For the sake of clarity, and to be consistent with the BIOMASS paper
(<a href="https://besjournals.onlinelibrary.wiley.com/doi/10.1111/2041-210X.12753" class="external-link">Réjou-Méchain
et al. 2017</a>), this vignette follows the same workflow as presented
in the paper:</p>
<p><img src="img/BIOMASS_workflow.png"></p>
<p>As can be seen, the <strong>estimate of the above ground
biomass</strong> (AGB) of a tree, and <strong>its associated
uncertainty</strong>, is based on its <strong>wood density</strong>,
<strong>diameter</strong>, and <strong>height</strong>.</p>
<p>However, exhaustive values of <strong>wood density</strong> and
<strong>height</strong> are rarely available in forest inventory data.
This is why the package proposes an estimate of these two covariables,
based on more usual data.</p>
<p>In this vignette, we will use some of the data obtained in 2012 from
a <a href="https://dataverse.cirad.fr/dataset.xhtml?persistentId=doi:10.18167/DVN1/TZ1RL9" class="external-link">forest
inventory</a> conducted in 2012 in the Nouragues forest (French Guiana).
For educational purpose, some virtual trees have been added to the
data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"NouraguesTrees"</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">NouraguesTrees</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="15%">
<col width="5%">
<col width="7%">
<col width="7%">
<col width="15%">
<col width="22%">
<col width="13%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="left">Site</th>
<th align="right">Plot</th>
<th align="right">Xfield</th>
<th align="right">Yfield</th>
<th align="left">Family</th>
<th align="left">Genus</th>
<th align="left">Species</th>
<th align="right">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">14</td>
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.0</td>
<td align="right">31.5</td>
<td align="left">Burseraceae</td>
<td align="left">Protium</td>
<td align="left">surinamense</td>
<td align="right">11.0</td>
</tr>
<tr class="even">
<td align="left">44</td>
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.1</td>
<td align="right">75.2</td>
<td align="left">Anacardiaceae</td>
<td align="left">Tapirira</td>
<td align="left">guianensis</td>
<td align="right">74.4</td>
</tr>
<tr class="odd">
<td align="left">13</td>
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.2</td>
<td align="right">27.6</td>
<td align="left">Lecythidaceae</td>
<td align="left">Indet.Lecythidaceae</td>
<td align="left">Indet.</td>
<td align="right">25.4</td>
</tr>
<tr class="even">
<td align="left">2810</td>
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">-4.0</td>
<td align="right">67.5</td>
<td align="left">Euphorbiaceae</td>
<td align="left">Conceveiba</td>
<td align="left">guyanensis</td>
<td align="right">10.0</td>
</tr>
<tr class="odd">
<td align="left">24</td>
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.3</td>
<td align="right">39.9</td>
<td align="left">Burseraceae</td>
<td align="left">Protium</td>
<td align="left">altissimum</td>
<td align="right">18.9</td>
</tr>
<tr class="even">
<td align="left">12100</td>
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">-3.5</td>
<td align="right">41.5</td>
<td align="left">Euphorbiaceae</td>
<td align="left">Mabea</td>
<td align="left">speciosa</td>
<td align="right">10.0</td>
</tr>
</tbody>
</table>
<p>These data do not contain any information on wood density or height
of trees. Only diameter is known, as no estimate can be made without
this information.</p>
</div>
<div class="section level2">
<h2 id="wood-density">Wood density<a class="anchor" aria-label="anchor" href="#wood-density"></a>
</h2>
<p><strong>Wood density</strong> is estimated <strong>from tree
taxonomy</strong>, using the <a href="https://datadryad.org/dataset/doi:10.5061/dryad.234" class="external-link">global wood
density database</a> as a reference. So the first step might be to
correct tree taxonomy.</p>
<div class="section level3">
<h3 id="checking-and-retrieving-tree-taxonomy">Checking and retrieving tree taxonomy<a class="anchor" aria-label="anchor" href="#checking-and-retrieving-tree-taxonomy"></a>
</h3>
<p>This is done with the <code><a href="../reference/correctTaxo.html">correctTaxo()</a></code> function, but before
calling it, let’s speak about cache !</p>
<p>When the function is called for the first time with the argument
<code>useCache = TRUE</code>, a temporary file containing the request to
<a href="https://tnrs.biendata.org/" class="external-link">TNRS</a> will be automatically
created in an existing folder. Once this has been done, during the
current session <strong>the use of <code>useCache = TRUE</code> will
access the saved temporary file</strong> in order to avoid
time-consuming replication of server requests. But <strong>by quitting
the current R session, this temporary file will be removed</strong>. So
before calling <code><a href="../reference/correctTaxo.html">correctTaxo()</a></code>, we advise you to define a
folder which will host the cache file permanently, enabling to work
offline.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># By default</span></span>
<span><span class="fu"><a href="../reference/createCache.html">createCache</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="co"># Or if you want to set your own cache folder</span></span>
<span><span class="fu"><a href="../reference/createCache.html">createCache</a></span><span class="op">(</span><span class="st">"the_path_to_your_cache_folder"</span><span class="op">)</span> </span>
<span><span class="co"># Or </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"BIOMASS.cache"</span> <span class="op">=</span> <span class="st">"the_path_to_your_cache_folder"</span><span class="op">)</span></span></code></pre></div>
<p>That said, let’s continue with the call to <code><a href="../reference/correctTaxo.html">correctTaxo()</a></code>
function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Taxo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correctTaxo.html">correctTaxo</a></span><span class="op">(</span></span>
<span>  genus <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">Genus</span>, <span class="co"># genus also accepts the whole species name (genus + species) or (genus + species + author) </span></span>
<span>  species <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">Species</span>, </span>
<span>  useCache <span class="op">=</span> <span class="cn">TRUE</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">Taxo</span>, file <span class="op">=</span> <span class="st">"saved_data/Taxo_vignette.rds"</span><span class="op">)</span></span></code></pre></div>
<p>The corrected genus and species of the trees can now be added to the
data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">GenusCorrected</span> <span class="op">&lt;-</span> <span class="va">Taxo</span><span class="op">$</span><span class="va">genusCorrected</span></span>
<span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">SpeciesCorrected</span> <span class="op">&lt;-</span> <span class="va">Taxo</span><span class="op">$</span><span class="va">speciesCorrected</span></span></code></pre></div>
<p>Here, as an example, the species name of the fourth tree has been
corrected from “guyanensis” to “guianensis” (the fourth row of
correctTaxo() output has a TRUE value for the column nameModified) :</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">Species</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] "guyanensis"</span></span>
<span><span class="va">Taxo</span><span class="op">[</span><span class="fl">4</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;   genusCorrected speciesCorrected nameModified</span></span>
<span><span class="co">#&gt; 4     Conceveiba       guianensis         TRUE</span></span></code></pre></div>
<p>If you want (but this is optional for the rest), you can retrieve APG
III families and orders from genus names.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">APG</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getTaxonomy.html">getTaxonomy</a></span><span class="op">(</span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">GenusCorrected</span>, findOrder <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">familyAPG</span> <span class="op">&lt;-</span> <span class="va">APG</span><span class="op">$</span><span class="va">family</span></span>
<span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">orderAPG</span> <span class="op">&lt;-</span> <span class="va">APG</span><span class="op">$</span><span class="va">order</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="getting-wood-density">Getting wood density<a class="anchor" aria-label="anchor" href="#getting-wood-density"></a>
</h3>
<p>Wood densities are retrieved using <code><a href="../reference/getWoodDensity.html">getWoodDensity()</a></code>
function. By default, this function assigns to each taxon a species- or
genus-level average if at least one wood density value of the same
species or genus is available in the reference database. For
unidentified trees or if the genus is missing in the reference database,
the stand-level mean wood density is assigned to the tree.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wood_densities</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getWoodDensity.html">getWoodDensity</a></span><span class="op">(</span></span>
<span>  genus <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">GenusCorrected</span>,</span>
<span>  species <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">SpeciesCorrected</span>,</span>
<span>  stand <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">Plot</span> <span class="co"># for unidentified or non-documented trees in the reference database</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; The reference dataset contains 16467 wood density values</span></span>
<span><span class="co">#&gt; Your taxonomic table contains 408 taxa</span></span>
<span></span>
<span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">WD</span> <span class="op">&lt;-</span> <span class="va">wood_densities</span><span class="op">$</span><span class="va">meanWD</span></span></code></pre></div>
<p>For information, here are the number of wood density values estimated
at the species, genus and plot level:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># At species level</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">wood_densities</span><span class="op">$</span><span class="va">levelWD</span> <span class="op">==</span> <span class="st">"species"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1291</span></span>
<span><span class="co"># At genus level</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">wood_densities</span><span class="op">$</span><span class="va">levelWD</span> <span class="op">==</span> <span class="st">"genus"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 586</span></span>
<span><span class="co"># At plot level</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">wood_densities</span><span class="op">$</span><span class="va">levelWD</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"genus"</span>, <span class="st">"species"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 173</span></span></code></pre></div>
<p>The <code>family</code> argument also assigns to the trees a
family-level wood density average, but bear in mind that the
taxon-average approach gives relatively poor estimates above the genus
level (Flores &amp; Coomes 2011).</p>
<p><strong>Additional wood density values can be added</strong> using
the <code>addWoodDensityData</code> argument (here invented for the
example):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LocalWoodDensity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  genus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Paloue"</span>, <span class="st">"Handroanthus"</span><span class="op">)</span>,</span>
<span>  species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"princeps"</span>, <span class="st">"serratifolius"</span><span class="op">)</span>,</span>
<span>  wd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.65</span>, <span class="fl">0.72</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">add_wood_densities</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getWoodDensity.html">getWoodDensity</a></span><span class="op">(</span></span>
<span>  genus <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">GenusCorrected</span>,</span>
<span>  species <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">SpeciesCorrected</span>,</span>
<span>  family <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">familyAPG</span>,</span>
<span>  stand <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">Plot</span>,</span>
<span>  addWoodDensityData <span class="op">=</span> <span class="va">LocalWoodDensity</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="height">Height<a class="anchor" aria-label="anchor" href="#height"></a>
</h2>
<p>As tree height measurements are rare, or rarely exhaustive, BIOMASS
proposes three methods to estimate tree height:</p>
<p>If a subset of well-measured trees is available in the studied
region:</p>
<ul>
<li>Construct a local Height–Diameter (H-D) allometry</li>
</ul>
<p>If not:</p>
<ul>
<li>Use the continent- or region-speciﬁc H–D models proposed by <a href="https://bg.copernicus.org/articles/9/3381/2012/" class="external-link">Feldpausch et
al. (2012)</a>
</li>
<li>Use a generic H–D model based on a single bioclimatic predictor E
(eqn 6a in <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/gcb.12629" class="external-link">Chave
et al. 2014</a>)</li>
</ul>
<div class="section level3">
<h3 id="building-a-local-h-d-model">Building a local H-D model<a class="anchor" aria-label="anchor" href="#building-a-local-h-d-model"></a>
</h3>
<p>As no height measurements is available in the
<code>NouraguesTrees</code> dataset, we will use the
<code>NouraguesHD</code> dataset which contains the height and diameter
measurements of two 1-ha plots from the Nouragues forest.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"NouraguesHD"</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/modelHD.html">modelHD()</a></code> function is used to either <strong>compare
four implemented models to ﬁt H–D relationships</strong> in the tropics,
or to <strong>compute the desired H-D model</strong>.</p>
<p>Here we first compare the four H-D models using linear regression
(for log^1 and log^2 models) or nonlinear least squares estimates (for
Michaelis-Menten and Weibull models) :</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HD_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelHD.html">modelHD</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">D</span>, H <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">H</span>,</span>
<span>  useWeight <span class="op">=</span> <span class="cn">TRUE</span>, drawGraph <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="Vignette_BIOMASS_files/figure-html/multiple_modelHD-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="va">HD_res</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">method</th>
<th align="right">RSE</th>
<th align="right">RSElog</th>
<th align="right">Average_bias</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">log1</td>
<td align="right">4.700088</td>
<td align="right">0.2472750</td>
<td align="right">0.0890365</td>
</tr>
<tr class="even">
<td align="left">log2</td>
<td align="right">4.329727</td>
<td align="right">0.2240379</td>
<td align="right">0.0385429</td>
</tr>
<tr class="odd">
<td align="left">weibull</td>
<td align="right">4.307951</td>
<td align="right">NA</td>
<td align="right">0.0028240</td>
</tr>
<tr class="even">
<td align="left">michaelis</td>
<td align="right">4.294488</td>
<td align="right">NA</td>
<td align="right">0.0145642</td>
</tr>
</tbody>
</table>
<p>As the log2 model has the lowest RSE, we will build this model using
the <code>method</code> argument and add its predictions to the dataset
with the <code><a href="../reference/retrieveH.html">retrieveH()</a></code> function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">HDmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelHD.html">modelHD</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">D</span>, H <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">H</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"log2"</span>, useWeight <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">H_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/retrieveH.html">retrieveH</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>,</span>
<span>  model <span class="op">=</span> <span class="va">HDmodel</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">H_model</span> <span class="op">&lt;-</span>  <span class="va">H_model</span><span class="op">$</span><span class="va">H</span></span></code></pre></div>
<p>By setting <code>bayesian = TRUE</code> in <code><a href="../reference/modelHD.html">modelHD()</a></code>
arguments, we could have built bayesian models using the brms package
(see section <a href="#bayesian-models">Building bayesian
Height-Diameter models</a>).</p>
<p>Note that if some of the trees’ heights had been measured in the
<code>NouraguesTrees</code> dataset, we could have provided these
heights to <code><a href="../reference/modelHD.html">modelHD()</a></code>. In this case, we could also have
created a model for each stand/sub-region present in
<code>NouraguesTrees</code> using the <code>plot</code> argument. But
keep in mind that even for well-measured trees, <code><a href="../reference/retrieveH.html">retrieveH()</a></code>
gives you the predicted height (see <a href="#mixing-measured_estimated">this section</a>).</p>
</div>
<div class="section level3">
<h3 id="using-the-continent--or-region-speciﬁc-hd-model-feldpausch">Using the continent- or region-speciﬁc H–D model (Feldpausch)<a class="anchor" aria-label="anchor" href="#using-the-continent--or-region-speci%EF%AC%81c-hd-model-feldpausch"></a>
</h3>
<p>No need to compute any model here, as the predictions of the model
proposed by Feldspausch et al. are directly retrieved by the
<code><a href="../reference/retrieveH.html">retrieveH()</a></code> function. Simply indicate the region
concerned:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H_feldspausch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/retrieveH.html">retrieveH</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>,</span>
<span>  region <span class="op">=</span> <span class="st">"GuianaShield"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">H_feldspausch</span> <span class="op">&lt;-</span> <span class="va">H_feldspausch</span><span class="op">$</span><span class="va">H</span></span></code></pre></div>
<p>Available regions are listed in the documentation of the
function.</p>
</div>
<div class="section level3">
<h3 id="using-the-generic-hd-model-based-on-a-bioclimatic-predictor-chave">Using the generic H–D model based on a bioclimatic predictor
(Chave)<a class="anchor" aria-label="anchor" href="#using-the-generic-hd-model-based-on-a-bioclimatic-predictor-chave"></a>
</h3>
<p>In the same way as for the previous model, the predictions of the
model proposed by Chave et al. are directly retrieved by the
<code><a href="../reference/retrieveH.html">retrieveH()</a></code> function. Coordinates of the plot (or trees) in
a longitude/latitude format must be provided.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"NouraguesCoords"</span><span class="op">)</span> <span class="co">#contains corner coordinates</span></span>
<span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">NouraguesCoords</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long"</span>,<span class="st">"Lat"</span><span class="op">)</span><span class="op">]</span> , <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span> <span class="co"># compute the mean of the corner coordinates</span></span>
<span></span>
<span><span class="va">H_chave</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/retrieveH.html">retrieveH</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>,</span>
<span>  coord <span class="op">=</span> <span class="va">coords</span><span class="op">)</span></span>
<span></span>
<span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">H_chave</span> <span class="op">&lt;-</span> <span class="va">H_chave</span><span class="op">$</span><span class="va">H</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="estimate-agb">Estimate AGB<a class="anchor" aria-label="anchor" href="#estimate-agb"></a>
</h2>
<p>Once tree diameter, wood density and height have been retrieved, the
generalised allometric model (eqn 4 of <a href="https://onlinelibrary.wiley.com/doi/abs/10.1111/gcb.12629" class="external-link">Chave
et al. (2014)</a>) can be used with the <code><a href="../reference/computeAGB.html">computeAGB()</a></code>
function, where AGB values are reported in Mg instead of in kg:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">AGB</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeAGB.html">computeAGB</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>,</span>
<span>  WD <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">WD</span>,</span>
<span>  H <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">H_model</span> <span class="co">#here with the local H-D predictions</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>For AGB estimates using tree heights obtained by the “Chave method”
(H_chave), it is more accurate to provide the area coordinates directly
instead of the tree height estimates:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">AGB_Chave</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/computeAGB.html">computeAGB</a></span><span class="op">(</span></span>
<span>    D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>,</span>
<span>    WD <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">WD</span>,</span>
<span>    coord <span class="op">=</span> <span class="va">coords</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="propagate-agb-errors">Propagate AGB errors<a class="anchor" aria-label="anchor" href="#propagate-agb-errors"></a>
</h2>
<p>The <code><a href="../reference/AGBmonteCarlo.html">AGBmonteCarlo()</a></code> function allows the user to
propagate diﬀerent sources of error up to the ﬁnal AGB estimate.</p>
<p>The error propagation due to the <strong>uncertainty of the model
parameters</strong> of the AGB allometric equation (Chave et al. 2014)
<strong>is automatically performed</strong> by the function. However,
the propagation of the error due to the <strong>uncertainty of the model
variables</strong> (D, WD and H) can be <strong>parameterized by the
user</strong>.</p>
<div class="section level3">
<h3 id="diameter-measurement-error">Diameter measurement error<a class="anchor" aria-label="anchor" href="#diameter-measurement-error"></a>
</h3>
<p>Using the <code>Dpropag</code> argument of the
<code><a href="../reference/AGBmonteCarlo.html">AGBmonteCarlo()</a></code> function, the user can set diameter
measurement errors by:</p>
<ul>
<li>providing a standard deviation value corresponding to the
measurement uncertainty (e.g <code>Dpropag = 1</code>)</li>
<li>providing a vector of standard deviation values associated with each
tree measurement uncertainty</li>
<li>using the implemented example of Chave et al. 2004 with
<code>Dpropag = "chave2004"</code>, where small errors are applied on
95% of the trees and large errors to the remaining 5%</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">D_error_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AGBmonteCarlo.html">AGBmonteCarlo</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>, WD <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">WD</span>, H <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">H_model</span>,</span>
<span>  Dpropag <span class="op">=</span> <span class="st">"chave2004"</span>,</span>
<span>  errWD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">NouraguesTrees</span><span class="op">)</span><span class="op">)</span>, errH <span class="op">=</span> <span class="fl">0</span> <span class="co"># no error propagation on WD and H here</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="wood-density-error">Wood density error<a class="anchor" aria-label="anchor" href="#wood-density-error"></a>
</h3>
<p>The <code><a href="../reference/getWoodDensity.html">getWoodDensity()</a></code> function returns prior standard
deviation values associated with each tree wood density using the mean
standard deviation of the <a href="https://datadryad.org/dataset/doi:10.5061/dryad.234" class="external-link">global wood
density database</a> at the species, genus and family levels.</p>
<p>This output can be provided through the <code>errWD</code>
argument:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">WD_error_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AGBmonteCarlo.html">AGBmonteCarlo</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>, WD <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">WD</span>, H <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">H_model</span>,</span>
<span>  errWD <span class="op">=</span> <span class="va">wood_densities</span><span class="op">$</span><span class="va">sdWD</span>,</span>
<span>  Dpropag <span class="op">=</span> <span class="fl">0</span> , errH <span class="op">=</span> <span class="fl">0</span> <span class="co"># no error propagation on D and H here</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="height-error">Height error<a class="anchor" aria-label="anchor" href="#height-error"></a>
</h3>
<p>The user can provide either a SD value or a vector of SD values
associated with tree height measurement errors, using the
<code>errH</code> argument.</p>
<ul>
<li>
<strong>If tree heights have been estimated via a local
HD-model</strong>, instead of the providing <code>errH</code> and
<code>H</code> arguments, the user has to provide the output of the
<code><a href="../reference/modelHD.html">modelHD()</a></code> function using the <code>modelHD</code>
argument:</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H_model_error_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AGBmonteCarlo.html">AGBmonteCarlo</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>, WD <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">WD</span>, <span class="co"># we do not provide H</span></span>
<span>  HDmodel <span class="op">=</span> <span class="va">HDmodel</span>, <span class="co"># but we provide HDmodel</span></span>
<span>  Dpropag <span class="op">=</span> <span class="fl">0</span> , errWD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">NouraguesTrees</span><span class="op">)</span><span class="op">)</span> <span class="co"># no error propagation on D and WD here</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that when HDmodel is not a bayesian model, uncertainties of the
are not propagated during the error propagation of the AGBmonteCarlo()
function.</p>
<ul>
<li>
<strong>If tree heights have been estimated via the “Feldspausch”
method</strong>, the user has to provide the output of the
<code><a href="../reference/retrieveH.html">retrieveH()</a></code> function for the <code>errH</code>
argument:</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H_feld_error_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AGBmonteCarlo.html">AGBmonteCarlo</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>, WD <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">WD</span>,</span>
<span>  H <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">H_feldspausch</span>, errH <span class="op">=</span> <span class="va">H_feldspausch</span><span class="op">$</span><span class="va">RSE</span>, <span class="co"># we provide H and errH</span></span>
<span>  Dpropag <span class="op">=</span> <span class="fl">0</span> , errWD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">NouraguesTrees</span><span class="op">)</span><span class="op">)</span> <span class="co"># no error propagation on D and WD here</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<strong>If tree heights have been estimated via the “Chave”
method</strong>, the user has to provide the coordinates of the area (or
of the trees) using the <code>coord</code> argument:</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">H_chave_error_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AGBmonteCarlo.html">AGBmonteCarlo</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>, WD <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">WD</span>, <span class="co"># we do not provide H</span></span>
<span>  coord <span class="op">=</span> <span class="va">coords</span>, <span class="co"># but we provide the vector of median coordinates of the plots</span></span>
<span>  Dpropag <span class="op">=</span> <span class="fl">0</span> , errWD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">NouraguesTrees</span><span class="op">)</span><span class="op">)</span> <span class="co"># no error propagation on D and WD here</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="all-together-and-agb-visualisation-of-plots">All together and AGB visualisation of plots<a class="anchor" aria-label="anchor" href="#all-together-and-agb-visualisation-of-plots"></a>
</h3>
<p>Let’s propagate all sources of errors using the HD-model:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">error_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AGBmonteCarlo.html">AGBmonteCarlo</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>, WD <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">WD</span>, <span class="co"># we do not provide H</span></span>
<span>  HDmodel <span class="op">=</span> <span class="va">HDmodel</span>, <span class="co"># but we provide HDmodel</span></span>
<span>  Dpropag <span class="op">=</span> <span class="st">"chave2004"</span>,</span>
<span>  errWD <span class="op">=</span> <span class="va">wood_densities</span><span class="op">$</span><span class="va">sdWD</span><span class="op">)</span></span>
<span></span>
<span><span class="va">error_prop</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; $meanAGB</span></span>
<span><span class="co">#&gt; [1] 1703.035</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $medAGB</span></span>
<span><span class="co">#&gt; [1] 1701.263</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sdAGB</span></span>
<span><span class="co">#&gt; [1] 46.91725</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $credibilityAGB</span></span>
<span><span class="co">#&gt;     2.5%    97.5% </span></span>
<span><span class="co">#&gt; 1614.013 1800.008</span></span></code></pre></div>
<p>The first four elements of the output contain the mean, median,
standard deviation and credibility intervals of the total AGB of the
dataset but nothing about the AGB at the plot level. To do this, you can
use the <code><a href="../reference/summaryByPlot.html">summaryByPlot()</a></code> function:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">AGB_by_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summaryByPlot.html">summaryByPlot</a></span><span class="op">(</span>AGB_val <span class="op">=</span> <span class="va">error_prop</span><span class="op">$</span><span class="va">AGB_simu</span>, plot <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">Plot</span>, drawPlot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Vignette_BIOMASS_files/figure-html/summaryByPlot-1.png" width="700" style="display: block; margin: auto;"></p>
<p>Finally, the last element (<code>$AGB_simu</code>) of the
<code><a href="../reference/AGBmonteCarlo.html">AGBmonteCarlo()</a></code> output is a matrix containing the simulated
tree AGB values (in rows) for each iteration of the Monte Carlo
procedure (in columns).</p>
</div>
</div>
<div class="section level2">
<h2 id="some-tricks">Some tricks<a class="anchor" aria-label="anchor" href="#some-tricks"></a>
</h2>
<div class="section level3">
<h3 id="mixing-measured_estimated">Mixing measured and estimated height values<a class="anchor" aria-label="anchor" href="#mixing-measured_estimated"></a>
</h3>
<p>If you want to use a mix of directly-measured height and of estimated
ones, you can proceed as follows:</p>
<ol class="example" style="list-style-type: decimal">
<li>Build a vector of H and RSE where we assume an error of 0.5 m on
directly measured trees</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NouraguesHD contains 163 trees that were not measured</span></span>
<span><span class="va">NouraguesHD</span><span class="op">$</span><span class="va">Hmix</span> <span class="op">&lt;-</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">H</span></span>
<span><span class="va">NouraguesHD</span><span class="op">$</span><span class="va">RSEmix</span> <span class="op">&lt;-</span> <span class="fl">0.5</span></span>
<span><span class="va">filt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">NouraguesHD</span><span class="op">$</span><span class="va">Hmix</span><span class="op">)</span></span>
<span><span class="va">NouraguesHD</span><span class="op">$</span><span class="va">Hmix</span><span class="op">[</span><span class="va">filt</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/retrieveH.html">retrieveH</a></span><span class="op">(</span><span class="va">NouraguesHD</span><span class="op">$</span><span class="va">D</span>, model <span class="op">=</span> <span class="va">HDmodel</span><span class="op">)</span><span class="op">$</span><span class="va">H</span><span class="op">[</span><span class="va">filt</span><span class="op">]</span></span>
<span><span class="va">NouraguesHD</span><span class="op">$</span><span class="va">RSEmix</span><span class="op">[</span><span class="va">filt</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">HDmodel</span><span class="op">$</span><span class="va">RSE</span></span></code></pre></div>
<ol start="2" class="example" style="list-style-type: decimal">
<li>Apply the AGBmonteCarlo by setting the height values and their
errors (which depend on whether the trees were directly measured or
estimated)</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getWoodDensity.html">getWoodDensity</a></span><span class="op">(</span><span class="va">NouraguesHD</span><span class="op">$</span><span class="va">genus</span>, <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="va">resultMC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AGBmonteCarlo.html">AGBmonteCarlo</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">D</span>, WD <span class="op">=</span> <span class="va">wd</span><span class="op">$</span><span class="va">meanWD</span>, errWD <span class="op">=</span> <span class="va">wd</span><span class="op">$</span><span class="va">sdWD</span>,</span>
<span>  H <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">Hmix</span>, errH <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">RSEmix</span>,</span>
<span>  Dpropag <span class="op">=</span> <span class="st">"chave2004"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/summaryByPlot.html">summaryByPlot</a></span><span class="op">(</span>AGB_val <span class="op">=</span> <span class="va">resultMC</span><span class="op">$</span><span class="va">AGB_simu</span>, plot <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">plotId</span>, drawPlot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bayesian-models">Building bayesian Height-Diameter models<a class="anchor" aria-label="anchor" href="#bayesian-models"></a>
</h3>
<p>Since version 2.2.6, BIOMASS enables to build bayesian H-D models
using the <a href="https://paulbuerkner.com/brms/" class="external-link">brms package</a>.</p>
<p>As compiling the Stan programme may take some time the first time
around, we recommend setting the ‘useCache’ argument to TRUE in the
<code><a href="../reference/modelHD.html">modelHD()</a></code> function. This will save the model as a .rds file
in the defined cache path, meaning that next time, the model will simply
be loaded and updated, bypassing the compilation stage.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, define the user cache path</span></span>
<span><span class="fu"><a href="../reference/createCache.html">createCache</a></span><span class="op">(</span><span class="st">"the_path_to_your_cache_folder"</span><span class="op">)</span> </span>
<span><span class="co"># Or </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"BIOMASS.cache"</span> <span class="op">=</span> <span class="st">"the_path_to_your_cache_folder"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">brm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelHD.html">modelHD</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">D</span>, H <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">H</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"log2"</span>,</span>
<span>  bayesian <span class="op">=</span> <span class="cn">TRUE</span>, useCache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">H_brm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/retrieveH.html">retrieveH</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">D</span>,</span>
<span>  model <span class="op">=</span> <span class="va">brm_model</span><span class="op">)</span></span>
<span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">H_model</span> <span class="op">&lt;-</span>  <span class="va">H_brm_model</span><span class="op">$</span><span class="va">H</span></span></code></pre></div>
<p>If the <strong>Michaelis-Menten or Weibull methods are used</strong>,
you must pay close attention to the returned models as the algorithm is
likely to identify numerous <strong>local minima for the estimated
parameters</strong>. Here is an example of the Weibull method being used
with the default arguments:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">brm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelHD.html">modelHD</a></span><span class="op">(</span></span>
<span>  D <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">D</span>, H <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">H</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"weibull"</span>,</span>
<span>  bayesian <span class="op">=</span> <span class="cn">TRUE</span>, useCache <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">brm_model</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="img/weibull_plot.png"></p>
<p>As one can see, the two first parameters a and b (resp. called
<code>b_a_Intercept</code> and <code>b_b_Intercept</code>) of the
Weibull equation:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo>=</mo><mi>a</mi><mo>⋅</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>e</mi><mi>x</mi><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mi>/</mi><mi>b</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>c</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">H=a  \cdot (1-exp(-(D/b)^c))</annotation></semantics></math>
are strongly correlated. Therefore, it is strongly recommended to define
priors that do not allow for unrealistic values. To do this, we need to
examine the meanings of the Weibull parameters:</p>
<ul>
<li>
<code>a</code> can be considered as the hypothetical maximum height,
so defining a uniform prior between 0 and 80m seems realistic.</li>
<li>
<code>b</code> is the scaling parameter, so defining a uniform prior
between 0 and a high value of D (e.g. the 90th percentile) makes
sense.</li>
<li>
<code>c</code> is the shape parameter which must be between 0 and
1</li>
</ul>
<p>Besides, since model parameters and chain iterations are strongly
correlated, an increase of <code>thin</code>, <code>iter</code> and
<code>warmup</code> is required (see the help of brms::brm() and <a href="https://mc-stan.org/learn-stan/diagnostics-warnings.html" class="external-link">this
page</a> for more details).</p>
<p>The arguments of <code><a href="https://paulbuerkner.com/brms/reference/brm.html" class="external-link">brms::brm()</a></code> (cited above) can be
provided to <code><a href="../reference/modelHD.html">modelHD()</a></code>:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weibull_priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu">set_prior</span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"uniform(0,80)"</span>, lb <span class="op">=</span> <span class="fl">0</span>, ub <span class="op">=</span> <span class="fl">80</span>, class <span class="op">=</span> <span class="st">"b"</span>,nlpar <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span>,</span>
<span>  <span class="fu">set_prior</span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"uniform(0,100)"</span>, lb <span class="op">=</span> <span class="fl">0</span>, ub <span class="op">=</span> <span class="fl">100</span>, class <span class="op">=</span> <span class="st">"b"</span>,nlpar <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span>,</span>
<span>  <span class="fu">set_prior</span><span class="op">(</span>prior <span class="op">=</span> <span class="st">"uniform(0.01,0.99)"</span>, lb <span class="op">=</span> <span class="fl">0.01</span>, ub <span class="op">=</span> <span class="fl">0.99</span>, class <span class="op">=</span> <span class="st">"b"</span>,nlpar <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">brm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelHD.html">modelHD</a></span><span class="op">(</span>D <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">D</span>, H <span class="op">=</span> <span class="va">NouraguesHD</span><span class="op">$</span><span class="va">H</span>,</span>
<span>                     method <span class="op">=</span> <span class="st">"weibull"</span>, bayesian <span class="op">=</span> <span class="cn">TRUE</span>, useCache <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     prior <span class="op">=</span> <span class="va">weibull_priors</span>,</span>
<span>                     thin <span class="op">=</span> <span class="fl">10</span>, iter <span class="op">=</span> <span class="fl">6000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                     cores <span class="op">=</span> <span class="fl">3</span> <span class="co"># number of cores = 3 since 3 chains are running </span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">brm_model</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="img/weibull_plot_2.png"></p>
<p>Posterior distributions look better but the right-skewed
distributions are not yet satisfactory. So <strong>we recommend using
the log2 method when the RSE given by lm and nls models (when bayesian =
FALSE) are close</strong>.</p>
</div>
<div class="section level3">
<h3 id="add-your-tricks">Add your tricks<a class="anchor" aria-label="anchor" href="#add-your-tricks"></a>
</h3>
<p>If you would like to share a code that might be useful to users (code
authorship will be respected), you can create a new issue on the <a href="https://github.com/umr-amap/BIOMASS/issues" class="external-link">BIOMASS github
page</a>, or contact Dominique (<a href="mailto:dominique.lamonica@ird.fr" class="email">dominique.lamonica@ird.fr</a>).</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Maxime Réjou-Méchain, Guillaume Cornu, Dominique Lamonica, Arthur Bailly, Arthur Pere, Ariane Tanguy, Camille Piponiot, Bruno Hérault.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
