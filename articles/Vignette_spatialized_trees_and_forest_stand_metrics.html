<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Spatialize trees and forest stand metrics with BIOMASS • BIOMASS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatialize trees and forest stand metrics with BIOMASS">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BIOMASS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">2.2.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Vignette_BIOMASS.html">Estimating stand biomass</a></li>
    <li><a class="dropdown-item" href="../articles/Vignette_spatialized_trees_and_forest_stand_metrics.html">Spatialize trees and forest stand metrics with BIOMASS</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/umr-amap/BIOMASS/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Spatialize trees and forest stand metrics with BIOMASS</h1>
                        <h4 data-toc-skip class="author">Arthur
Bailly</h4>
            
            <h4 data-toc-skip class="date">2025-10-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/umr-amap/BIOMASS/blob/master/vignettes/Vignette_spatialized_trees_and_forest_stand_metrics.Rmd" class="external-link"><code>vignettes/Vignette_spatialized_trees_and_forest_stand_metrics.Rmd</code></a></small>
      <div class="d-none name"><code>Vignette_spatialized_trees_and_forest_stand_metrics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>BIOMASS enables users to manage their plots by:</p>
<ul>
<li><p>calculating the projected/geographic coordinates of the plot’s
corners and the trees from the relative coordinates (or local
coordinates, <em>i.e.</em> those of the field)</p></li>
<li><p>visualising the plots</p></li>
<li><p>validating plot’s corners and tree coordinates with LiDAR
data</p></li>
<li><p>dividing plots into subplots</p></li>
<li><p>summarising any tree metric at subplot level</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="required-data">Required data<a class="anchor" aria-label="anchor" href="#required-data"></a>
</h2>
<p>Two data frames are required to perform the analysis. One for the
corner of the plot(s), and one for the trees, which contains at least
their coordinates.</p>
<ul>
<li>The <strong>corner data frame</strong> must contains at least:
<ul>
<li>the names of the corresponding plots if there are several plots
(below referred as to the ‘Plot’ column)</li>
<li>the coordinates of the plot’s corners in the <strong>geographic or
projected coordinate system</strong> (the GPS coordinates, below
referred as to the ‘Xutm’ and ‘Yutm’ columns)</li>
<li>the coordinates of the plot’s corners in the <strong>plot’s relative
coordinate system</strong> (the local or field coordinates, below
referred as to the ‘Xfield’ and ‘Yfield’ columns)</li>
</ul>
</li>
</ul>
<p>In this vignette, for educational purpose, we will not use only one
but <strong>two datasets of corner coordinates</strong>, derived from
permanent plots in the <a href="https://dataverse.cirad.fr/dataset.xhtml?persistentId=doi:10.18167/DVN1/TZ1RL9" class="external-link">Nouragues
forest</a> (French Guiana):</p>
<ol style="list-style-type: decimal">
<li>
<strong>NouraguesPlot201</strong> which contains simulated corner
coordinates of <strong>one plot with repeated GPS measurements of each
corner</strong>:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"NouraguesPlot201"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">NouraguesPlot201</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">5</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, caption <span class="op">=</span> <span class="st">"Head of NouraguesPlot201"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Head of NouraguesPlot201</caption>
<colgroup>
<col width="20%">
<col width="7%">
<col width="10%">
<col width="10%">
<col width="13%">
<col width="13%">
<col width="14%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">Site</th>
<th align="right">Plot</th>
<th align="right">Xfield</th>
<th align="right">Yfield</th>
<th align="right">Xutm</th>
<th align="right">Yutm</th>
<th align="right">Long</th>
<th align="right">Lat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">313002.7</td>
<td align="right">451723.1</td>
<td align="right">-52.68451</td>
<td align="right">4.08504</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">313007.5</td>
<td align="right">451720.5</td>
<td align="right">-52.68446</td>
<td align="right">4.08502</td>
</tr>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">313008.7</td>
<td align="right">451723.4</td>
<td align="right">-52.68445</td>
<td align="right">4.08504</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">313002.8</td>
<td align="right">451725.7</td>
<td align="right">-52.68451</td>
<td align="right">4.08506</td>
</tr>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">313005.8</td>
<td align="right">451722.1</td>
<td align="right">-52.68448</td>
<td align="right">4.08503</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">313010.5</td>
<td align="right">451736.0</td>
<td align="right">-52.68444</td>
<td align="right">4.08516</td>
</tr>
</tbody>
</table>
<ol start="2" style="list-style-type: decimal">
<li>
<strong>NouraguesCoords</strong> which contains corner coordinates
of <strong>four plots with a single GPS measurement of each
corner</strong>, also derived from Nouragues forest:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"NouraguesCoords"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">NouraguesCoords</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">5</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, caption <span class="op">=</span> <span class="st">"Head of NouraguesCoords"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Head of NouraguesCoords</caption>
<colgroup>
<col width="20%">
<col width="7%">
<col width="10%">
<col width="10%">
<col width="13%">
<col width="13%">
<col width="14%">
<col width="11%">
</colgroup>
<thead><tr class="header">
<th align="left">Site</th>
<th align="right">Plot</th>
<th align="right">Xfield</th>
<th align="right">Yfield</th>
<th align="right">Xutm</th>
<th align="right">Yutm</th>
<th align="right">Long</th>
<th align="right">Lat</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">313007.9</td>
<td align="right">451717.2</td>
<td align="right">-52.68446</td>
<td align="right">4.08499</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0</td>
<td align="right">100</td>
<td align="right">313095.8</td>
<td align="right">451669.5</td>
<td align="right">-52.68367</td>
<td align="right">4.08456</td>
</tr>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">100</td>
<td align="right">0</td>
<td align="right">312960.2</td>
<td align="right">451629.3</td>
<td align="right">-52.68489</td>
<td align="right">4.08419</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">100</td>
<td align="right">100</td>
<td align="right">313048.0</td>
<td align="right">451581.6</td>
<td align="right">-52.68410</td>
<td align="right">4.08376</td>
</tr>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">204</td>
<td align="right">0</td>
<td align="right">300</td>
<td align="right">313271.5</td>
<td align="right">451574.0</td>
<td align="right">-52.68208</td>
<td align="right">4.08370</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">204</td>
<td align="right">0</td>
<td align="right">400</td>
<td align="right">313359.4</td>
<td align="right">451526.3</td>
<td align="right">-52.68129</td>
<td align="right">4.08327</td>
</tr>
</tbody>
</table>
<ul>
<li>The data frame including the <strong>tree coordinates</strong>, must
contain at least:
<ul>
<li>the name of the plots if there are several plots</li>
<li>the tree coordinates in the plot’s relative coordinate system (the
local/field one)</li>
<li>the desired information about trees, such as diameter, wood density,
height, AGB, etc. (see BIOMASS vignette)</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"NouraguesTrees"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">NouraguesTrees</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, caption <span class="op">=</span> <span class="st">"Head of the table trees"</span><span class="op">)</span></span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Head of the table trees</caption>
<colgroup>
<col width="16%">
<col width="5%">
<col width="8%">
<col width="8%">
<col width="16%">
<col width="23%">
<col width="14%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">Site</th>
<th align="right">Plot</th>
<th align="right">Xfield</th>
<th align="right">Yfield</th>
<th align="left">Family</th>
<th align="left">Genus</th>
<th align="left">Species</th>
<th align="right">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.0</td>
<td align="right">31.5</td>
<td align="left">Burseraceae</td>
<td align="left">Protium</td>
<td align="left">surinamense</td>
<td align="right">11.0</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.1</td>
<td align="right">75.2</td>
<td align="left">Anacardiaceae</td>
<td align="left">Tapirira</td>
<td align="left">guianensis</td>
<td align="right">74.4</td>
</tr>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.2</td>
<td align="right">27.6</td>
<td align="left">Lecythidaceae</td>
<td align="left">Indet.Lecythidaceae</td>
<td align="left">Indet.</td>
<td align="right">25.4</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">-4.0</td>
<td align="right">67.5</td>
<td align="left">Euphorbiaceae</td>
<td align="left">Conceveiba</td>
<td align="left">guyanensis</td>
<td align="right">10.0</td>
</tr>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.3</td>
<td align="right">39.9</td>
<td align="left">Burseraceae</td>
<td align="left">Protium</td>
<td align="left">altissimum</td>
<td align="right">18.9</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">-3.5</td>
<td align="right">41.5</td>
<td align="left">Euphorbiaceae</td>
<td align="left">Mabea</td>
<td align="left">speciosa</td>
<td align="right">10.0</td>
</tr>
</tbody>
</table>
<p>This dataset is also derived from the <a href="https://dataverse.cirad.fr/dataset.xhtml?persistentId=doi:10.18167/DVN1/TZ1RL9" class="external-link">2012
Nouragues forest dataset</a>, but for educational purpose, some virtual
trees with erroneous coordinates have been added in the data.</p>
</div>
<div class="section level2">
<h2 id="checking-plots-coordinates">Checking plot’s coordinates<a class="anchor" aria-label="anchor" href="#checking-plots-coordinates"></a>
</h2>
<p>Two situations may occur:</p>
<ul>
<li><p>The <strong>GPS coordinates</strong> of the plot corners are
considered <strong>very accurate</strong> or <strong>enough measurements
have been made</strong> to be confident in the accuracy of their
average. In this case, the shape of the plot measured on the field will
follow the GPS coordinates of the plot corners when projected into the
projected/geographic coordinate system. See <a href="#trustGSPcorner">3.1.1</a></p></li>
<li><p><strong>Too few measurements of the GPS coordinates</strong> of
plot corners have been collected and/or are <strong>not
reliable</strong>. In this case, <strong>the shape of the plot measured
on the field is considered to be accurate</strong> and the GPS corner
coordinates will be recalculated to fit the shape and dimensions of the
plot. See <a href="#trustPlotShape">3.1.2</a></p></li>
</ul>
<p>In both cases, the use of the <code><a href="../reference/check_plot_coord.html">check_plot_coord()</a></code>
function is recommended as a first step.</p>
<div class="section level3">
<h3 id="checking-the-corners-of-the-plot">Checking the corners of the plot<a class="anchor" aria-label="anchor" href="#checking-the-corners-of-the-plot"></a>
</h3>
<p>The <code><a href="../reference/check_plot_coord.html">check_plot_coord()</a></code> function handles both situations
using the <code>trust_GPS_corners</code> argument (= TRUE or FALSE).</p>
<p>You can give either geographical coordinates with the ‘longlat’
argument or another projected coordinates with the ‘proj_coord’ argument
for the corner coordinates.</p>
<div class="section level4">
<h4 id="trustGSPcorner">If we rely on the GPS coordinates of the corners:<a class="anchor" aria-label="anchor" href="#trustGSPcorner"></a>
</h4>
<ul>
<li><p>When only <strong>1 GPS measurement by corner</strong> has been
recorded <strong>with a high degree of accuracy</strong> (by a geometer,
for example), or if you already have averaged your measurements by
yourself, you can supply these 4 GPS coordinates to the
function.</p></li>
<li><p>When <strong>enough coordinates have been recorded for each
corner</strong> (for more information, see the <a href="https://lpvs.gsfc.nasa.gov/PDF/CEOS_WGCV_LPV_Biomass_Protocol_2021_V1.0.pdf" class="external-link">CEOS
good practices protocol, section A.1.3.1</a> ), coordinates will be
averaged by corner, resulting in 4 reference coordinates. The function
can also detect and remove GPS outliers using the ‘rm_outliers’ and
‘max_dist’ arguments.</p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_plot_trust_GPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_plot_coord.html">check_plot_coord</a></span><span class="op">(</span></span>
<span>  corner_data <span class="op">=</span> <span class="va">NouraguesPlot201</span>,</span>
<span>  longlat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long"</span>, <span class="st">"Lat"</span><span class="op">)</span>,  <span class="co"># or proj_coord = c("Xutm", "Yutm"), </span></span>
<span>  rel_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>, <span class="st">"Yfield"</span><span class="op">)</span>,</span>
<span>  trust_GPS_corners <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  draw_plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  max_dist <span class="op">=</span> <span class="fl">10</span>, rm_outliers <span class="op">=</span> <span class="cn">TRUE</span> <span class="op">)</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/check_plot_trust_GPS-1.png" width="1458.33333333333" style="display: block; margin: auto;"></p>
<p>The two blue arrows represent the origin of the plot’s relative
coordinate system.</p>
</div>
<div class="section level4">
<h4 id="trustPlotShape">If we rely on the shape of the plot measured on the field:<a class="anchor" aria-label="anchor" href="#trustPlotShape"></a>
</h4>
<p>Let’s degrade the data to mimic the case where we only have 8
unreliable GPS coordinates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">degraded_corner_coord</span> <span class="op">&lt;-</span> <span class="va">NouraguesPlot201</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">11</span><span class="op">:</span><span class="fl">12</span>,<span class="fl">21</span><span class="op">:</span><span class="fl">22</span>,<span class="fl">31</span><span class="op">:</span><span class="fl">32</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">check_plot_trust_field</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_plot_coord.html">check_plot_coord</a></span><span class="op">(</span></span>
<span>  corner_data <span class="op">=</span> <span class="va">degraded_corner_coord</span>,</span>
<span>  longlat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long"</span>, <span class="st">"Lat"</span><span class="op">)</span>,  <span class="co"># or proj_coord = c("Xutm", "Yutm"), </span></span>
<span>  rel_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>, <span class="st">"Yfield"</span><span class="op">)</span>,</span>
<span>  trust_GPS_corners <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  draw_plot <span class="op">=</span> <span class="cn">TRUE</span>, rm_outliers <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning:  Be carefull, you may have GNSS measurement outliers. </span></span>
<span><span class="co">#&gt;  Removing them may improve the georeferencing of your plot (see rm_outliers and max_dist arguments).</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/unnamed-chunk-4-1.png" width="1458.33333333333" style="display: block; margin: auto;"></p>
<p>We can see that the corners of the plot do not match the GPS
measurements. In fact, they correspond to the best compromise between
the shape and dimensions of the plot and the GPS measurements.</p>
</div>
</div>
<div class="section level3">
<h3 id="recovering-reference-corner-coordinates-and-the-associated-polygons">Recovering reference corner coordinates and the associated
polygon(s)<a class="anchor" aria-label="anchor" href="#recovering-reference-corner-coordinates-and-the-associated-polygons"></a>
</h3>
<p>Reference corner coordinates are returned by the function via the
<code>$corner_coord</code> output, with standardised column names for
future data processing.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="va">check_plot_trust_GPS</span><span class="op">$</span><span class="va">corner_coord</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, caption <span class="op">=</span> <span class="st">"Reference corner coordinates"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Reference corner coordinates</caption>
<thead><tr class="header">
<th align="right">x_rel</th>
<th align="right">y_rel</th>
<th align="right">x_proj</th>
<th align="right">y_proj</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">313005.7</td>
<td align="right">451723.2</td>
</tr>
<tr class="even">
<td align="right">100</td>
<td align="right">0</td>
<td align="right">312956.9</td>
<td align="right">451630.2</td>
</tr>
<tr class="odd">
<td align="right">100</td>
<td align="right">100</td>
<td align="right">313050.2</td>
<td align="right">451582.6</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">100</td>
<td align="right">313100.5</td>
<td align="right">451665.9</td>
</tr>
</tbody>
</table>
<p>The associated polygon is returned via the <code>$polygon</code>
output and can be saved into a shapefile as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">check_plot_trust_GPS</span><span class="op">$</span><span class="va">polygon</span>, <span class="st">"your_directory/plot201.shp"</span><span class="op">)</span></span></code></pre></div>
<p>For full details, the <code>$outlier_corners</code> output returns
all the information about GPS outliers found by the function, and the
<code>$UTM_code</code> output returns the UTM code calculated by the
function if geographic coordinates have been provided.</p>
</div>
<div class="section level3">
<h3 id="tree_coordinates">Visualising and retrieving projected tree coordinates<a class="anchor" aria-label="anchor" href="#tree_coordinates"></a>
</h3>
<p>Tree coordinates are usually measured in the plot’s relative
coordinate system. To project them in the projected system, you can
supply their relative coordinates using the <code>tree_data</code> and
<code>tree_coords</code> arguments.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot201Trees</span> <span class="op">&lt;-</span> <span class="va">NouraguesTrees</span><span class="op">[</span><span class="va">NouraguesTrees</span><span class="op">$</span><span class="va">Plot</span><span class="op">==</span><span class="fl">201</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">check_plot_trust_GPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_plot_coord.html">check_plot_coord</a></span><span class="op">(</span></span>
<span>  corner_data <span class="op">=</span> <span class="va">NouraguesPlot201</span>,</span>
<span>  longlat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long"</span>, <span class="st">"Lat"</span><span class="op">)</span>, rel_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>, <span class="st">"Yfield"</span><span class="op">)</span>,</span>
<span>  trust_GPS_corners <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tree_data <span class="op">=</span> <span class="va">plot201Trees</span>, tree_coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>,<span class="st">"Yfield"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in check_corner_fct(.SD):  Be careful, one or more trees are not inside the plot defined by rel_coord (see is_in_plot column of tree_data output)</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/unnamed-chunk-7-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The projected coordinates of the trees are added to the tree
data-frame and returned by the output <code>$tree_data</code> (columns
x_proj and y_proj).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot201Trees</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xutm"</span>,<span class="st">"Yutm"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">check_plot_trust_GPS</span><span class="op">$</span><span class="va">tree_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_proj"</span>,<span class="st">"y_proj"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">check_plot_trust_GPS</span><span class="op">$</span><span class="va">tree_data</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, caption <span class="op">=</span> <span class="st">"Head of the $tree_data output"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Head of the $tree_data output</caption>
<colgroup>
<col width="21%">
<col width="7%">
<col width="9%">
<col width="9%">
<col width="7%">
<col width="13%">
<col width="13%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="left">Site</th>
<th align="right">Plot</th>
<th align="right">x_rel</th>
<th align="right">y_rel</th>
<th align="right">D</th>
<th align="right">x_proj</th>
<th align="right">y_proj</th>
<th align="left">is_in_plot</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.0</td>
<td align="right">31.5</td>
<td align="right">11.0</td>
<td align="right">313035.6</td>
<td align="right">451705.1</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.1</td>
<td align="right">75.2</td>
<td align="right">74.4</td>
<td align="right">313077.0</td>
<td align="right">451680.0</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.2</td>
<td align="right">27.6</td>
<td align="right">25.4</td>
<td align="right">313031.8</td>
<td align="right">451707.2</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">-4.0</td>
<td align="right">67.5</td>
<td align="right">10.0</td>
<td align="right">313071.7</td>
<td align="right">451688.0</td>
<td align="left">FALSE</td>
</tr>
<tr class="odd">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">0.3</td>
<td align="right">39.9</td>
<td align="right">18.9</td>
<td align="right">313043.4</td>
<td align="right">451700.1</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">Petit_Plateau</td>
<td align="right">201</td>
<td align="right">-3.5</td>
<td align="right">41.5</td>
<td align="right">10.0</td>
<td align="right">313046.8</td>
<td align="right">451702.5</td>
<td align="left">FALSE</td>
</tr>
</tbody>
</table>
<p>The output of the function also standardises the names of the
relative tree coordinates (to <code>x_rel</code> and <code>y_rel</code>)
and adds the <code>is_in_plot</code> column, indicating if a tree is in
the plot or not.</p>
<p>You can also access and modify the plot via the
<code>$plot_design</code> output which is a ggplot object. For example,
to change the plot title:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_to_change</span> <span class="op">&lt;-</span> <span class="va">check_plot_trust_GPS</span><span class="op">$</span><span class="va">plot_design</span></span>
<span><span class="va">plot_to_change</span> <span class="op">&lt;-</span> <span class="va">plot_to_change</span> <span class="op">+</span> <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"A custom title"</span><span class="op">)</span></span>
<span><span class="va">plot_to_change</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/unnamed-chunk-9-1.png" width="700" style="display: block; margin: auto;"></p>
<p>If you provided longitude and latitude corner coordinates, you can
retrieve the GPS coordinates of the trees in a longitude/latitude format
using this code:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_GPS_coord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span> <span class="fu">proj4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/proj4/man/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">check_plot_trust_GPS</span><span class="op">$</span><span class="va">tree_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_proj"</span>,<span class="st">"y_proj"</span><span class="op">)</span><span class="op">]</span>, proj <span class="op">=</span> <span class="va">check_plot_trust_GPS</span><span class="op">$</span><span class="va">UTM_code</span><span class="op">$</span><span class="va">UTM_code</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="integrating-lidar-data">Integrating LiDAR data<a class="anchor" aria-label="anchor" href="#integrating-lidar-data"></a>
</h3>
<p>If you have LiDAR data in raster format (typically a CHM raster) that
you want to compare with a tree metric, this can be done with the
<code>ref_raster</code> and the <code>prop_tree</code> arguments.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load internal CHM raster</span></span>
<span><span class="va">nouraguesRaster</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"NouraguesRaster.tif"</span>,package <span class="op">=</span> <span class="st">"BIOMASS"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">check_plot_trust_GPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_plot_coord.html">check_plot_coord</a></span><span class="op">(</span></span>
<span>  corner_data <span class="op">=</span> <span class="va">NouraguesPlot201</span>,</span>
<span>  longlat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Long"</span>, <span class="st">"Lat"</span><span class="op">)</span>, rel_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>, <span class="st">"Yfield"</span><span class="op">)</span>,</span>
<span>  trust_GPS_corners <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tree_data <span class="op">=</span> <span class="va">plot201Trees</span>, tree_coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>,<span class="st">"Yfield"</span><span class="op">)</span>, prop_tree <span class="op">=</span> <span class="st">"D"</span>, <span class="co"># here the treediameter</span></span>
<span>  ref_raster <span class="op">=</span> <span class="va">nouraguesRaster</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in check_corner_fct(.SD):  Be careful, one or more trees are not inside the plot defined by rel_coord (see is_in_plot column of tree_data output)</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/unnamed-chunk-11-1.png" width="700" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="checking-multiple-plots-at-once">Checking multiple plots at once<a class="anchor" aria-label="anchor" href="#checking-multiple-plots-at-once"></a>
</h3>
<p>When <code>corner_data</code> and <code>tree_data</code> contain
several plots, you have to supply the column names containing the plots
IDs of the corners and the trees via the <code>plot_ID</code> and
<code>tree_plot_ID</code> arguments:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multiple_checks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_plot_coord.html">check_plot_coord</a></span><span class="op">(</span></span>
<span>  corner_data <span class="op">=</span> <span class="va">NouraguesCoords</span>, <span class="co"># NouraguesCoords contains 4 plots</span></span>
<span>  proj_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xutm"</span>, <span class="st">"Yutm"</span><span class="op">)</span>, rel_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>, <span class="st">"Yfield"</span><span class="op">)</span>,</span>
<span>  trust_GPS_corners <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  plot_ID <span class="op">=</span> <span class="st">"Plot"</span>,</span>
<span>  tree_data <span class="op">=</span> <span class="va">NouraguesTrees</span>, tree_coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>,<span class="st">"Yfield"</span><span class="op">)</span>, </span>
<span>  prop_tree <span class="op">=</span> <span class="st">"D"</span>, tree_plot_ID <span class="op">=</span> <span class="st">"Plot"</span>,</span>
<span>  ref_raster <span class="op">=</span> <span class="va">nouraguesRaster</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in check_corner_fct(.SD): In plot 201 : Be careful, one or more trees are not inside the plot defined by rel_coord (see is_in_plot column of tree_data output)</span></span>
<span><span class="co">#&gt; Warning in check_corner_fct(.SD): In plot 213 : Be careful, one or more trees are not inside the plot defined by rel_coord (see is_in_plot column of tree_data output)</span></span>
<span><span class="co">#&gt; Warning in check_corner_fct(.SD): In plot 223 : Be careful, one or more trees are not inside the plot defined by rel_coord (see is_in_plot column of tree_data output)</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/unnamed-chunk-12-1.png" width="700" style="display: block; margin: auto;"><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/unnamed-chunk-12-2.png" width="700" style="display: block; margin: auto;"><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/unnamed-chunk-12-3.png" width="700" style="display: block; margin: auto;"><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/unnamed-chunk-12-4.png" width="700" style="display: block; margin: auto;"></p>
<p>Be aware that by default, the function will ask you to type Enter
between each plot (argument ‘ask = TRUE’).</p>
</div>
</div>
<div class="section level2">
<h2 id="dividing-plots">Dividing plots<a class="anchor" aria-label="anchor" href="#dividing-plots"></a>
</h2>
<p>Dividing plots into several sub-plots is performed using the
<code><a href="../reference/divide_plot.html">divide_plot()</a></code> function. This function takes the relative
coordinates of the 4 corners of the plot to divide it into a grid. Be
aware that <strong>the plot must be rectangular in the plot’s relative
coordinates system</strong>, <em>i.e.</em> have 4 right angles:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subplots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divide_plot.html">divide_plot</a></span><span class="op">(</span></span>
<span>  corner_data <span class="op">=</span> <span class="va">check_plot_trust_GPS</span><span class="op">$</span><span class="va">corner_coord</span>,</span>
<span>  rel_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_rel"</span>,<span class="st">"y_rel"</span><span class="op">)</span>,</span>
<span>  proj_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_proj"</span>,<span class="st">"y_proj"</span><span class="op">)</span>,</span>
<span>  grid_size <span class="op">=</span> <span class="fl">25</span> <span class="co"># or c(25,25)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">subplots</span><span class="op">$</span><span class="va">sub_corner_coord</span>, <span class="fl">10</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">1</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, caption <span class="op">=</span> <span class="st">"Head of the divide_plot()$sub_corner_coord output."</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Head of the divide_plot()$sub_corner_coord output.</caption>
<thead><tr class="header">
<th align="left">plot_ID</th>
<th align="left">subplot_ID</th>
<th align="right">x_rel</th>
<th align="right">y_rel</th>
<th align="right">x_proj</th>
<th align="right">y_proj</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left">subplot_0_0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">313005.7</td>
<td align="right">451723.2</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">subplot_0_0</td>
<td align="right">25</td>
<td align="right">0</td>
<td align="right">312993.5</td>
<td align="right">451699.9</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">subplot_0_0</td>
<td align="right">25</td>
<td align="right">25</td>
<td align="right">313017.1</td>
<td align="right">451686.2</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">subplot_0_0</td>
<td align="right">0</td>
<td align="right">25</td>
<td align="right">313029.4</td>
<td align="right">451708.9</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">subplot_1_0</td>
<td align="right">25</td>
<td align="right">0</td>
<td align="right">312993.5</td>
<td align="right">451699.9</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">subplot_1_0</td>
<td align="right">50</td>
<td align="right">0</td>
<td align="right">312981.3</td>
<td align="right">451676.7</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">subplot_1_0</td>
<td align="right">50</td>
<td align="right">25</td>
<td align="right">313004.8</td>
<td align="right">451663.6</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">subplot_1_0</td>
<td align="right">25</td>
<td align="right">25</td>
<td align="right">313017.1</td>
<td align="right">451686.2</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">subplot_2_0</td>
<td align="right">50</td>
<td align="right">0</td>
<td align="right">312981.3</td>
<td align="right">451676.7</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">subplot_2_0</td>
<td align="right">75</td>
<td align="right">0</td>
<td align="right">312969.1</td>
<td align="right">451653.5</td>
</tr>
</tbody>
</table>
<p>If you want to stay in the plot’s relative coordinate system, just
set <code>proj_coord</code> = NULL.</p>
<p>The function also handles imperfect cuts with the arguments
<code>centred_grid</code> and <code>grid_tol</code>. Here an example
with a 40mx45m grid.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subplots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divide_plot.html">divide_plot</a></span><span class="op">(</span></span>
<span>  corner_data <span class="op">=</span> <span class="va">check_plot_trust_GPS</span><span class="op">$</span><span class="va">corner_coord</span>, </span>
<span>  rel_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_rel"</span>,<span class="st">"y_rel"</span><span class="op">)</span>, proj_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_proj"</span>,<span class="st">"y_proj"</span><span class="op">)</span>,</span>
<span>  grid_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>,<span class="fl">45</span><span class="op">)</span>, </span>
<span>  centred_grid <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># centre the grid in the middle of the plot</span></span>
<span>  grid_tol <span class="op">=</span> <span class="fl">0.3</span> <span class="co"># by default =0.1, ie, if more than 10% of the plot is not covered by the grid, it will returned an error</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in divide_plot_rel_coord_fct(.SD, grid_size): </span></span>
<span><span class="co">#&gt; The x-dimension of the plot is not a multiple of the x-dimension of the grid size</span></span>
<span><span class="co">#&gt; Warning in divide_plot_rel_coord_fct(.SD, grid_size): </span></span>
<span><span class="co">#&gt; The y-dimension of the plot is not a multiple of the y-dimension of the grid size</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/imperfect_cuts_visualisation-1.png" width="50%" style="display: block; margin: auto;"><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/imperfect_cuts_visualisation-2.png" width="50%" style="display: block; margin: auto;"></p>
<p>For the purpose of summarising and representing subplots (coming in
the next section), the function returns the coordinates of subplot
corners but can also <strong>assign to each tree its subplot</strong>
with the <strong><code>tree_data</code> and <code>tree_coords</code>
arguments</strong>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add AGB predictions (calculated in Vignette BIOMASS) to plot201Trees</span></span>
<span><span class="va">AGB_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"saved_data/NouraguesTreesAGB.rds"</span><span class="op">)</span></span>
<span><span class="va">plot201Trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">plot201Trees</span> , <span class="va">AGB_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>,<span class="st">"Yfield"</span>,<span class="st">"D"</span>,<span class="st">"AGB"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subplots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divide_plot.html">divide_plot</a></span><span class="op">(</span></span>
<span>  corner_data <span class="op">=</span> <span class="va">check_plot_trust_GPS</span><span class="op">$</span><span class="va">corner_coord</span>, </span>
<span>  rel_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_rel"</span>,<span class="st">"y_rel"</span><span class="op">)</span>,</span>
<span>  proj_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x_proj"</span>,<span class="st">"y_proj"</span><span class="op">)</span>,</span>
<span>  grid_size <span class="op">=</span> <span class="fl">25</span>, <span class="co"># or c(25,25)</span></span>
<span>  tree_data <span class="op">=</span> <span class="va">plot201Trees</span>, tree_coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>,<span class="st">"Yfield"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in divide_plot(corner_data = check_plot_trust_GPS$corner_coord, : One</span></span>
<span><span class="co">#&gt; or more trees could not be assigned to a subplot (not in a subplot area)</span></span></code></pre></div>
<p>The function now returns a list containing:</p>
<ul>
<li><p><code>sub_corner_coord</code>: coordinates of subplot corners as
previously</p></li>
<li><p><code>tree_data</code>: the tree data-frame with the
<strong>subplot_ID added in last column</strong></p></li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">kable</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">subplots</span><span class="op">$</span><span class="va">tree_data</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">1</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span>, caption <span class="op">=</span> <span class="st">"Head of the divide_plot()$tree_data returns"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>Head of the divide_plot()$tree_data returns</caption>
<colgroup>
<col width="6%">
<col width="5%">
<col width="14%">
<col width="20%">
<col width="12%">
<col width="9%">
<col width="9%">
<col width="4%">
<col width="8%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="right">x_rel</th>
<th align="right">Plot</th>
<th align="left">Family</th>
<th align="left">Genus</th>
<th align="left">Species</th>
<th align="right">Xutm</th>
<th align="right">Yutm</th>
<th align="right">AGB</th>
<th align="left">plot_ID</th>
<th align="left">subplot_ID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">-3.5</td>
<td align="right">201</td>
<td align="left">Euphorbiaceae</td>
<td align="left">Mabea</td>
<td align="left">speciosa</td>
<td align="right">313046.8</td>
<td align="right">451702.5</td>
<td align="right">0.1</td>
<td align="left"></td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">-4.0</td>
<td align="right">201</td>
<td align="left">Euphorbiaceae</td>
<td align="left">Conceveiba</td>
<td align="left">guyanensis</td>
<td align="right">313071.7</td>
<td align="right">451688.0</td>
<td align="right">0.0</td>
<td align="left"></td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">0.0</td>
<td align="right">201</td>
<td align="left">Burseraceae</td>
<td align="left">Protium</td>
<td align="left">surinamense</td>
<td align="right">313035.6</td>
<td align="right">451705.1</td>
<td align="right">0.1</td>
<td align="left"></td>
<td align="left">subplot_0_1</td>
</tr>
<tr class="even">
<td align="right">0.1</td>
<td align="right">201</td>
<td align="left">Anacardiaceae</td>
<td align="left">Tapirira</td>
<td align="left">guianensis</td>
<td align="right">313077.0</td>
<td align="right">451680.0</td>
<td align="right">4.7</td>
<td align="left"></td>
<td align="left">subplot_0_3</td>
</tr>
<tr class="odd">
<td align="right">0.2</td>
<td align="right">201</td>
<td align="left">Lecythidaceae</td>
<td align="left">Indet.Lecythidaceae</td>
<td align="left">Indet.</td>
<td align="right">313031.8</td>
<td align="right">451707.2</td>
<td align="right">0.6</td>
<td align="left"></td>
<td align="left">subplot_0_1</td>
</tr>
<tr class="even">
<td align="right">0.3</td>
<td align="right">201</td>
<td align="left">Burseraceae</td>
<td align="left">Protium</td>
<td align="left">altissimum</td>
<td align="right">313043.4</td>
<td align="right">451700.1</td>
<td align="right">0.2</td>
<td align="left"></td>
<td align="left">subplot_0_1</td>
</tr>
</tbody>
</table>
<p>Last but not least, the function can handle as many plots as you
want, using the <code>corner_plot_ID</code> and
<code>tree_plot_ID</code> arguments:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multiple_subplots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divide_plot.html">divide_plot</a></span><span class="op">(</span></span>
<span>  corner_data <span class="op">=</span> <span class="va">NouraguesCoords</span>,</span>
<span>  rel_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>,<span class="st">"Yfield"</span><span class="op">)</span>, proj_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xutm"</span>,<span class="st">"Yutm"</span><span class="op">)</span>, corner_plot_ID <span class="op">=</span> <span class="st">"Plot"</span>,</span>
<span>  grid_size <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  tree_data <span class="op">=</span> <span class="va">NouraguesTrees</span>, tree_coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Xfield"</span>,<span class="st">"Yfield"</span><span class="op">)</span>, tree_plot_ID <span class="op">=</span> <span class="st">"Plot"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in divide_plot(corner_data = NouraguesCoords, rel_coord = c("Xfield", :</span></span>
<span><span class="co">#&gt; One or more trees could not be assigned to a subplot (not in a subplot area)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="summarising-tree-metrics-at-subplot-level">Summarising tree metrics at subplot level<a class="anchor" aria-label="anchor" href="#summarising-tree-metrics-at-subplot-level"></a>
</h2>
<p>Once you’ve applied the <code><a href="../reference/divide_plot.html">divide_plot()</a></code> function with a
non-null <code>tree_data</code> argument, you can summarise any tree
metric at the subplot level with the <code><a href="../reference/subplot_summary.html">subplot_summary()</a></code>
function.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subplot_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subplot_summary.html">subplot_summary</a></span><span class="op">(</span></span>
<span>  subplots <span class="op">=</span> <span class="va">subplots</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"AGB"</span>, <span class="co"># AGB was added before applying divide_plot()</span></span>
<span>  per_ha <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "Creating sf_polygons for each subplot..."</span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/subplot_summary-1.png" width="700" style="display: block; margin: auto;"></p>
<p><strong>By default, the function sums the metric per subplot</strong>
and divides the result by the area of each subplot (to obtain a summary
<strong>per hectare</strong>), but you can request any valid function
using <code>fun</code> argument and choose between a raw or a per
hectare summary using <code>per_ha</code> argument.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subplot_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subplot_summary.html">subplot_summary</a></span><span class="op">(</span></span>
<span>  subplots <span class="op">=</span> <span class="va">subplots</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"AGB"</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">quantile</span>, probs <span class="op">=</span> <span class="fl">0.5</span>, <span class="co"># yes, it is the median</span></span>
<span>  per_ha <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Creating sf_polygons for each subplot..."</span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/subplot_summary_quantile-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The output of the function is a list containing:</p>
<ul>
<li><p><code>$tree_summary</code>: a summary of the metric per
subplot</p></li>
<li><p><code>$polygon</code>: an object of the class <code>sf</code>
containing a simple feature collection of the subplot’s polygon</p></li>
<li><p><code>$plot_design</code>: a ggplot object that can easily be
modified</p></li>
</ul>
<p>The returned <strong>polygons can be saved into a shapefile</strong>
like this:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set the CRS of the polygons</span></span>
<span><span class="va">subplot_polygons</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_set_crs</a></span><span class="op">(</span></span>
<span>  <span class="va">subplot_metric</span><span class="op">$</span><span class="va">polygon</span> ,</span>
<span>  value <span class="op">=</span> <span class="st">"EPSG:2972"</span><span class="op">)</span> <span class="co"># EPSG:2972 (corresponding to UTM Zone 22N) is the UTM coordinate system of Nouragues</span></span>
<span></span>
<span><span class="co"># Save the polygons in a shapefile</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">subplot_polygons</span>, <span class="st">"your_directory/subplots_201.shp"</span><span class="op">)</span></span></code></pre></div>
<p>And of course, the function can handle <strong>as many plots as
provided in divide_plot()</strong>:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multiple_subplot_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subplot_summary.html">subplot_summary</a></span><span class="op">(</span></span>
<span>  subplots <span class="op">=</span> <span class="va">multiple_subplots</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"D"</span>, fun <span class="op">=</span> <span class="va">mean</span>, per_ha <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Creating sf_polygons for each subplot..."</span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/subplot_summary_display_trees-1.png" width="700" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/subplot_summary_display_trees-2.png" width="700" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/subplot_summary_display_trees-3.png" width="700" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/subplot_summary_display_trees-4.png" width="700" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="customizing-the-ggplot">Customizing the ggplot<a class="anchor" aria-label="anchor" href="#customizing-the-ggplot"></a>
</h3>
<p>Here are some examples to custom the ggplot of the
<code><a href="../reference/subplot_summary.html">subplot_summary()</a></code> function:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subplot_metric</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subplot_summary.html">subplot_summary</a></span><span class="op">(</span>subplots <span class="op">=</span> <span class="va">subplots</span>,</span>
<span>                                  value <span class="op">=</span> <span class="st">"AGB"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "Creating sf_polygons for each subplot..."</span></span>
<span><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/customize_plot-1.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">custom_plot</span> <span class="op">&lt;-</span> <span class="va">subplot_metric</span><span class="op">$</span><span class="va">plot_design</span></span>
<span><span class="co"># Change the title and legend:</span></span>
<span><span class="va">custom_plot</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Nouragues plot"</span> , fill<span class="op">=</span><span class="st">"Sum of AGB per hectare"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/customize_plot-2.png" width="700" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Display trees with diameter as size and transparency (and a smaller legend on the right): </span></span>
<span><span class="va">custom_plot</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data<span class="op">=</span><span class="va">plot201Trees</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Xutm</span>, y <span class="op">=</span> <span class="va">Yutm</span>, size <span class="op">=</span> <span class="va">D</span>, alpha<span class="op">=</span> <span class="va">D</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">1</span>,<span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Sum of AGB per hectare"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">guides</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Diameter (cm)"</span><span class="op">)</span>,</span>
<span>         size <span class="op">=</span> <span class="fu">guide_legend</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Diameter (cm)"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span>, legend.key.size <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">'cm'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Vignette_spatialized_trees_and_forest_stand_metrics_files/figure-html/customize_plot-3.png" width="700" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Maxime Réjou-Méchain, Guillaume Cornu, Dominique Lamonica, Arthur Bailly, Arthur Pere, Ariane Tanguy, Camille Piponiot, Bruno Hérault.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
